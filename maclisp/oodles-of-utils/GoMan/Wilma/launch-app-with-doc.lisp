;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; launch-app-with-doc;;;;;;;; This function is basically an addendum to processes.lisp, posted at Cambridge;;;; ftp site.  It allows you to launch applications with other files, just as if the;;;; the user attempted to drag-and-drop the files onto an application.  This is handy;;;; if, for instance, you wanted a text file to be edited in BBEdit rather than whatever;;;; application created it.;;;;;;;; This function works up through System 7 Pro.  It will probably work under System 7.5;;;; with its scriptable Finder but there will be a better way to perform this function;;;; with that Finder.;;;;;;;; To use, pass the application's pathname as the first argument and a list of file;;;; pathnames as the second argument.  If you have only one file pathname then it does;;;; not have to be in a list.  The function will return the application's pathname if it;;;; is successful.;;;;;;;; Thanks to Bill St. Clair, the author of processes.lisp!;;;;;;;; Dan S. Camper;;;; camper@applelink.apple.com;;;;(in-package :ccl)(require :appleevent-toolkit)(require :processes)(export '(launch-application-with-doc))(defun launch-application-with-doc (filename &optional (doc-paths nil))  (let ((err nil)        (result nil))    (rlet ((fsspec :FSSpec))      (rlet ((pb :launchParamBlockRec                 :launchBlockID #$extendedBlock                 :launchEPBLength #$extendedBlockLen                 :launchControlFlags (+ #$launchContinue #$launchNoFileFlags)                 :launchAppSpec fsspec                 :launchAppParameters (%null-ptr)))        (with-pstrs ((name (mac-namestring (probe-file filename))))          (#_FSMakeFSSpec 0 0 name fsspec))        (if doc-paths          (progn            (unless (consp doc-paths)              (setf doc-paths (list doc-paths)))            (with-aedescs (event temp-event target aliases)              (create-self-target target)              (create-appleevent event #$kCoreEventClass #$kAEOpenDocuments target)              (create-alias-list aliases doc-paths)              (ae-error (#_AEPutParamDesc event #$keyDirectObject aliases))              (#_AECoerceDesc event #$typeAppParameters temp-event)              (with-pointers ((temp-event-ptr (rref temp-event :AEDesc.DataHandle)))                (setf (rref pb :launchParamBlockRec.launchAppParameters) temp-event-ptr)                (setf err (#_LaunchApplication pb)))))          (setf err (#_LaunchApplication pb)))        (if (eql err #$noErr)          (setf result filename))))    result))