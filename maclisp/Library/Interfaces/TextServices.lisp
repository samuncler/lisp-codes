(in-package :TRAPS); Generated from #P"HD:CCL3.0d17:Interface Translator:Source interfaces:Pascal Interfaces:TextServices.p"; at Tuesday June 6,1995 2:22:04 pm.; ;  	File:		TextServices.p;  ;  	Contains:	Text Services Manager Interfaces.;  ;  	Version:	Technology:	System 7.5;  				Package:	Universal Interfaces 2.0 in “MPW Latest” on ETO #17;  ;  	Copyright:	© 1984-1995 by Apple Computer, Inc.;  				All rights reserved.;  ;  	Bugs?:		If you find a problem with this file, use the Apple Bug Reporter;  				stack.  Include the file and version information (from above);  				in the problem description and send to:;  					Internet:	apple.bugs@applelink.apple.com;  					AppleLink:	APPLE.BUGS;  ; #|                                              ; $IFC UNDEFINED UsingIncludes; $SETC UsingIncludes := 0 |#                                             ; $ENDC; $IFC NOT UsingIncludes; $ENDC; $IFC UNDEFINED __TEXTSERVICES__; $SETC __TEXTSERVICES__ := 1; $I+; $SETC TextServicesIncludes := UsingIncludes; $SETC UsingIncludes := 1#|                                              ; $IFC UNDEFINED __TYPES__|#(require-interface 'Types)#|                                              ; $I Types.p |#                                             ; $ENDC; 	ConditionalMacros.p											#|                                              ; $IFC UNDEFINED __EVENTS__|#(require-interface 'Events)#|                                              ; $I Events.p |#                                             ; $ENDC; 	Quickdraw.p													; 		MixedMode.p												; 		QuickdrawText.p											; 	OSUtils.p													; 		Memory.p												#|                                              ; $IFC UNDEFINED __MENUS__|#(require-interface 'Menus)#|                                              ; $I Menus.p |#                                             ; $ENDC#|                                              ; $IFC UNDEFINED __APPLEEVENTS__|#(require-interface 'AppleEvents)#|                                              ; $I AppleEvents.p |#                                             ; $ENDC; 	Errors.p													; 	EPPC.p														; 		AppleTalk.p												; 		Files.p													; 		PPCToolbox.p											; 		Processes.p												; 	Notification.p												#|                                              ; $IFC UNDEFINED __ERRORS__|#(require-interface 'Errors)#|                                              ; $I Errors.p |#                                             ; $ENDC#|                                              ; $IFC UNDEFINED __COMPONENTS__|#(require-interface 'Components)#|                                              ; $I Components.p |#                                             ; $ENDC; $PUSH; $ALIGN MAC68K; $LibExport+(defconstant $kTSMVersion #x200)                ;  Version of the Text Services Manager is 2.0  (defconstant $kTextService :|tsvc|)             ;  component type for the component description (defconstant $kInputMethodService :|inpm|)      ;  component subtype for the component description ;  Component Flags in ComponentDescription (defconstant $bTakeActiveEvent 15)              ;  bit set if the component takes active event (defconstant $bHandleAERecording 16)            ;  bit set if the component takes care of recording Apple Events <new in vers2.0> (defconstant $bScriptMask #x7F00)               ;  bit 8 - 14 (defconstant $bLanguageMask #xFF)               ;  bit 0 - 7  (defconstant $bScriptLanguageMask (+ #$bScriptMask #$bLanguageMask));  bit 0 - 14  ;  Hilite styles (defconstant $kCaretPosition 1)                 ;  specify caret position (defconstant $kRawText 2)                       ;  specify range of raw text (defconstant $kSelectedRawText 3)               ;  specify range of selected raw text (defconstant $kConvertedText 4)                 ;  specify range of converted text (defconstant $kSelectedConvertedText 5)         ;  specify range of selected converted text ;  Apple Event constants ;  Event class (defconstant $kTextServiceClass #$kTextService);  event ID (defconstant $kUpdateActiveInputArea :|updt|)   ;  update the active Inline area (defconstant $kPos2Offset :|p2st|)              ;  converting global coordinates to char position (defconstant $kOffset2Pos :|st2p|)              ;  converting char position to global coordinates (defconstant $kShowHideInputWindow :|shiw|)     ;  show or hide the input window ;  Event keywords (defconstant $keyAETSMDocumentRefcon :|refc|)   ;  TSM document refcon, typeLongInteger ;  Note: keyAETSMScriptTag, keyAERequestedType, keyAETSMTextFont, keyAETextPointSize; 	typeAEText, typeIntlWritingCode, typeQDPoint, and keyAEAngle have been moved to ; 	AERegistry.h (defconstant $keyAEServerInstance :|srvi|)      ;  component instance (defconstant $keyAETheData :|kdat|)             ;  typeText (defconstant $keyAEFixLength :|fixl|)           ;  fix len ?? (defconstant $keyAEHiliteRange :|hrng|)         ;  hilite range array (defconstant $keyAEUpdateRange :|udng|)         ;  update range array (defconstant $keyAEClauseOffsets :|clau|)       ;  Clause Offsets array (defconstant $keyAECurrentPoint :|cpos|)        ;  current point (defconstant $keyAEDragging :|bool|)            ;  dragging falg (defconstant $keyAEOffset :|ofst|)              ;  offset (defconstant $keyAERegionClass :|rgnc|)         ;  region class (defconstant $keyAEPoint :|gpos|)               ;  current point (defconstant $keyAEBufferSize :|buff|)          ;  buffer size to get the text (defconstant $keyAEMoveView :|mvvw|)            ;  move view flag (defconstant $keyAELength :|leng|)              ;  length (defconstant $keyAENextBody :|nxbd|)            ;  next or previous body ;  optional keywords for Offset2Pos (Info about the active input area) (defconstant $keyAETextLineHeight :|ktlh|)      ;  typeShortInteger (defconstant $keyAETextLineAscent :|ktas|)      ;  typeShortInteger ;  optional keywords for Pos2Offset (defconstant $keyAELeftSide :|klef|)            ;  type Boolean ;  optional keywords for kShowHideInputWindow (defconstant $keyAEShowHideInputWindow :|shiw|) ;  type Boolean ;  for PinRange  (defconstant $keyAEPinRange :|pnrg|);  Desc type ... (defconstant $typeComponentInstance :|cmpi|)    ;  server instance (defconstant $typeTextRangeArray :|tray|)       ;  text range array (defconstant $typeOffsetArray :|ofay|)          ;  offset array (defconstant $typeText #$typeChar)              ;  Plain text (defconstant $typeTextRange :|txrn|);  Desc type constants (defconstant $kTSMOutsideOfBody 1)(defconstant $kTSMInsideOfBody 2)(defconstant $kTSMInsideOfActiveInputArea 3)(defconstant $kNextBody 1)(defconstant $kPreviousBody 2);  typeTextRange 		'txrn' (defrecord TextRange    (fStart :signed-long)   (fEnd :signed-long)   (fHiliteStyle :signed-integer)   )(def-mactype :textrangeptr (find-mactype '(:pointer :textrange)))(def-mactype :textrangehandle (find-mactype '(:handle :textrange)));  typeTextRangeArray	'txra' (defrecord TextRangeArray    (fNumOfRanges :signed-integer)               ;  specify the size of the fRange array    (fRange (:array :textrange 1))               ;  when fNumOfRanges > 1, the size of this array has to be calculated    )(def-mactype :textrangearrayptr (find-mactype '(:pointer :textrangearray)))(def-mactype :textrangearrayhandle (find-mactype '(:handle :textrangearray)));  typeOffsetArray		'offa' (defrecord OffsetArray    (fNumOfOffsets :signed-integer)              ;  specify the size of the fOffset array    (fOffset (:array :signed-long 1))            ;  when fNumOfOffsets > 1, the size of this array has to be calculated    )(def-mactype :offsetarrayptr (find-mactype '(:pointer :offsetarray)))(def-mactype :offsetarrayhandle (find-mactype '(:handle :offsetarray)))(def-mactype :tsmdocumentid (find-mactype ':pointer))(defrecord InterfaceTypeList (array (array :ostype 1)));  Text Service Info List (defrecord TextServiceInfo    (fComponent (:pointer :componentrecord))   (fItemName (:string 255))   )(def-mactype :textserviceinfoptr (find-mactype '(:pointer :textserviceinfo)))(defrecord TextServiceList    (fTextServiceCount :signed-integer)          ;  number of entries in the 'fServices' array    (fServices (:array :textserviceinfo 1))      ;  Note: array of 'TextServiceInfo' records follows    )(def-mactype :textservicelistptr (find-mactype '(:pointer :textservicelist)))(def-mactype :textservicelisthandle (find-mactype '(:handle :textservicelist)))(defrecord ScriptLanguageRecord    (fScript :signed-integer)   (fLanguage :signed-integer)   )(defrecord ScriptLanguageSupport    (fScriptLanguageCount :signed-integer)       ;  number of entries in the 'fScriptLanguageArray' array    (fScriptLanguageArray (:array :scriptlanguagerecord 1));  Note: array of 'ScriptLanguageRecord' records follows    )(def-mactype :scriptlanguagesupportptr (find-mactype '(:pointer :scriptlanguagesupport)))(def-mactype :scriptlanguagesupporthandle (find-mactype '(:handle :scriptlanguagesupport)));  Low level routines which are dispatched directly to the Component Manager (defconstant $kCMGetScriptLangSupport #x1)      ;  Component Manager call selector 1 (defconstant $kCMInitiateTextService #x2)       ;  Component Manager call selector 2 (defconstant $kCMTerminateTextService #x3)      ;  Component Manager call selector 3 (defconstant $kCMActivateTextService #x4)       ;  Component Manager call selector 4 (defconstant $kCMDeactivateTextService #x5)     ;  Component Manager call selector 5 (defconstant $kCMTextServiceEvent #x6)          ;  Component Manager call selector 6 (defconstant $kCMGetTextServiceMenu #x7)        ;  Component Manager call selector 7 (defconstant $kCMTextServiceMenuSelect #x8)     ;  Component Manager call selector 8 (defconstant $kCMFixTextService #x9)            ;  Component Manager call selector 9 (defconstant $kCMSetTextServiceCursor #xA)      ;  Component Manager call selector 10 (defconstant $kCMHidePaletteWindows #xB)        ;  Component Manager call selector 11 ;  High level TSM routines ; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_NewTSMDocument" ((numOfInterface :signed-integer) (supportedInterfaceTypes (:pointer :interfacetypelist)) (idocID (:pointer :pointer)) (refcon :signed-long))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 0 numOfInterface supportedInterfaceTypes idocID refcon)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_DeleteTSMDocument" ((idocID :pointer))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 1 idocID)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_ActivateTSMDocument" ((idocID :pointer))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 2 idocID)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_DeactivateTSMDocument" ((idocID :pointer))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 3 idocID)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_TSMEvent" ((event (:pointer :eventrecord)))   (:stack :boolean)   (:stack-trap #xAA54 :d0 4 event)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_TSMMenuSelect" ((menuResult :signed-long))   (:stack :boolean)   (:stack-trap #xAA54 :d0 5 menuResult)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_SetTSMCursor" ((mousePos :point))   (:stack :boolean)   (:stack-trap #xAA54 :d0 6 mousePos)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_FixTSMDocument" ((idocID :pointer))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 7 idocID)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_GetServiceList" ((numOfInterface :signed-integer) (supportedInterfaceTypes (:pointer :ostype)) (serviceInfo (:pointer (:handle :textservicelist))) (seedValue (:pointer :signed-long)))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 8 numOfInterface supportedInterfaceTypes serviceInfo seedValue)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_OpenTextService" ((idocID :pointer) (aComponent (:pointer :componentrecord)) (aComponentInstance (:pointer (:pointer :componentinstancerecord))))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 9 idocID aComponent aComponentInstance)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_CloseTextService" ((idocID :pointer) (aComponentInstance (:pointer :componentinstancerecord)))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 10 idocID aComponentInstance)); $ENDC; CONST                                         ; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_SendAEFromTSMComponent" ((theAppleEvent (:pointer :aedesc)) (reply (:pointer :aedesc)) (sendMode :signed-long) (sendPriority :signed-integer) (timeOutInTicks :signed-long) (idleProc :pointer) (filterProc :pointer))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 11 theAppleEvent reply sendMode sendPriority timeOutInTicks idleProc filterProc)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_InitTSMAwareApplication" ()   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 20)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_CloseTSMAwareApplication" ()   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 21)); $ENDC;  Utilities ; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_SetDefaultInputMethod" ((ts (:pointer :componentrecord)) (slRecordPtr (:pointer :scriptlanguagerecord)))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 12 ts slRecordPtr)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_GetDefaultInputMethod" ((ts (:pointer (:pointer :componentrecord))) (slRecordPtr (:pointer :scriptlanguagerecord)))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 13 ts slRecordPtr)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_SetTextServiceLanguage" ((slRecordPtr (:pointer :scriptlanguagerecord)))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 14 slRecordPtr)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_GetTextServiceLanguage" ((slRecordPtr (:pointer :scriptlanguagerecord)))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 15 slRecordPtr)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_UseInputWindow" ((idocID :pointer) (useWindow :boolean))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 16 idocID useWindow)); $ENDC; CONST                                         ; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_NewServiceWindow" ((wStorage :pointer) (boundsRect (:pointer :rect)) (title (:string 255)) (visible :boolean) (theProc :signed-integer) (behind (:pointer :grafport)) (goAwayFlag :boolean) (ts (:pointer :componentinstancerecord)) (window (:pointer (:pointer :grafport))))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 17 wStorage boundsRect title visible theProc behind goAwayFlag ts window)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_CloseServiceWindow" ((window (:pointer :grafport)))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 18 window)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_GetFrontServiceWindow" ((window (:pointer (:pointer :grafport))))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 19 window)); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator moveq-word-to-d0(deftrap "_FindServiceWindow" ((thePoint :point) (theWindow (:pointer (:pointer :grafport))))   (:stack :signed-integer)   (:stack-trap #xAA54 :d0 23 thePoint theWindow)); $ENDC;  Low level TSM routines ; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_GetScriptLanguageSupport" ((ts (:pointer :componentinstancerecord)) (scriptHdl (:pointer (:handle :scriptlanguagesupport))))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts scriptHdl ((+ (ash 4 16) 1) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_InitiateTextService" ((ts (:pointer :componentinstancerecord)))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts ((+ (ash 0 16) 2) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_TerminateTextService" ((ts (:pointer :componentinstancerecord)))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts ((+ (ash 0 16) 3) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_ActivateTextService" ((ts (:pointer :componentinstancerecord)))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts ((+ (ash 0 16) 4) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_DeactivateTextService" ((ts (:pointer :componentinstancerecord)))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts ((+ (ash 0 16) 5) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_TextServiceEvent" ((ts (:pointer :componentinstancerecord)) (numOfEvents :signed-integer) (event (:pointer :eventrecord)))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts numOfEvents event ((+ (ash 6 16) 6) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_GetTextServiceMenu" ((ts (:pointer :componentinstancerecord)) (serviceMenu (:pointer (:handle :menuinfo))))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts serviceMenu ((+ (ash 4 16) 7) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_TextServiceMenuSelect" ((ts (:pointer :componentinstancerecord)) (serviceMenu (:handle :menuinfo)) (item :signed-integer))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts serviceMenu item ((+ (ash 6 16) 8) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_FixTextService" ((ts (:pointer :componentinstancerecord)))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts ((+ (ash 0 16) 9) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_SetTextServiceCursor" ((ts (:pointer :componentinstancerecord)) (mousePos :point))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts mousePos ((+ (ash 4 16) 10) :signed-longint))); $ENDC; $IFC NOT GENERATINGCFM;; Generated by translator push-a-constant-longword-on-stack(deftrap "_HidePaletteWindows" ((ts (:pointer :componentinstancerecord)))   (:stack :signed-long)   (:stack-trap #xA82A :d0 0 ts ((+ (ash 0 16) 11) :signed-longint))); $ENDC; $ALIGN RESET; $POP; $SETC UsingIncludes := TextServicesIncludes; $ENDC                                         ; __TEXTSERVICES__; $IFC NOT UsingIncludes; $ENDC(provide-interface 'TextServices)