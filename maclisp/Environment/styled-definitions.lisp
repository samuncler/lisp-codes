;;-*- Mode: Lisp; Package: CCL -*-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	styled-definitions.lisp;;;;	copyright © 1992 Apple Computer, Inc.;;;;	This file will installs a menu item in the Edit menu that sets the names;;	in all of the definitions in the front window to the style specified in ;;	*definition-style* (bold and underline look nice).  The action is ;;	undo-able.  See the code below for an example.;;(in-package :ccl);;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;  Mod Hisory;;;; 4/17/95 Dieter       Minor modifications for MCL 3.0;;;;;; 02/05/92 drw		First draft for MCL 2.0 - Derek White.;;(provide :styled-definitions)(export '*definition-style*)(defvar *definition-style* '()  "The font-spec that the Styled Definitions menu uses to modify the text styles. Modify to taste. Example: (setq *definition-style* '(:bold))." )(defconstant *set-defs-menu-name* "Styled Definitions"  "The name of the 'Styled Definitions' menu.")(defun defun-to-defined-pos (buf pos)  "Given the position of the the begining of the '(defxxx nnn',   return the beginning and end positions of 'nnn'."    (let ((space-tab-str "0123"))    (setf (schar space-tab-str 0) #\space)    (setf (schar space-tab-str 1) #\tab)    (setf (schar space-tab-str 2) #\newline)    (setf (schar space-tab-str 3) #\))    (setq pos (+ 1 (buffer-char-pos buf space-tab-str :start pos)))    (if (eq (buffer-char buf pos) #\()  ; (probably '(setf xxx)', we want to highlight the whole thing      (buffer-current-sexp-bounds buf pos)         (values pos (buffer-char-pos buf space-tab-str :start pos)))))(defun set-definitions-style (w font-spec)  "Set the style of the defined name {anything after '(defxxx '} to font-spec"  (if (typep w 'fred-window)    (let ((defs (list-definitions w))          (buf (fred-buffer w)))      (dolist (x defs)        (multiple-value-bind (start end) (defun-to-defined-pos buf (cdr x))          (buffer-set-font-spec buf font-spec start end)))      (fred-update w))    (ed-beep)))(defun handle-set-definition-style (w)  "Call set-definitions-style, but set up the Undo/Redo menu too."  (set-definitions-style w *definition-style*)  (setup-undo (window-key-handler w)              #'(lambda ()                  (set-definitions-style w :plain)                  (setup-undo w                              #'(lambda ()                                  (handle-set-definition-style w))                              "Redo Styled Definitions"))              "Undo Styled Definitions"))(add-menu-items *edit-menu*                (make-instance 'menu-item :menu-item-title "-")                (make-instance 'menu-item                  :menu-item-title *set-defs-menu-name*                  :menu-item-action #'(lambda ()                                        (handle-set-definition-style (front-window) ))                  :command-key #\U));;  Use this to get rid of the menu.; (remove-menu-items *edit-menu* (find-menu-item  *edit-menu* *set-defs-menu-name*));;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;  Modify below to change the definition style;;(setq *definition-style* '(:bold))#|; Really gross style. But hey, maybe you like it.(setq *definition-style* '(:outline :italic "Courier" 12)); Back to something normal(setq *definition-style* '(:plain  "Monaco" 9))|#